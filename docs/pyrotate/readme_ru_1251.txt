pyrotate v0.90
для ротации и/или архивации логов (и любых других) файлов
Copyright Евгений Егоров (aka Evgeniy Egorov aka Eugene Egorow), 2008-2012
E-mail anyhow2(at)mail.ru

Лицензия - GNU General Public License v2

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation version 2 of the License.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

v0.90 изменения:
  - изменено и протестировано для работы в Windows (XP)
  - исправлено немножко багов
  - поправлена документация

v0.88 изменения:
  - протестировано для работы с Python v2.7 и 3.2
  - в случае ошибки вместо завершения программы происходит возврат с
    ненулевым кодом
  - добавлены  двойные двойные кавычки ("") для имен файлов в командной
    строке чтобы можно было использовать имена файлов с пробелами
    (пример результирующей команды теперь выглядит так:
    /usr/bin/zip  ""/rota/txt_120620.zip"" ""/rota/lis*.txt"")

v0.8 изменения:
  - добавлена опциональная отсылка сообщения об ошибках на почту, если
    в каталоге программы (или в пути Питона) будет присутствовать
    sender.py и в конфигурационном файле будут указаны 'mailfrom'
    и 'mailto'
  - в предыдущих версиях в случае если не существовал целевой каталог
    для создаваемого файла архива, то архиватор мог остановливаться
    и долго ждать реакции пользователя. Теперь нужный каталог создается,
    если нет возможности - пишется сообщение об ошибке.

v0.6 изменения:
  - изменено и протестировано для работы в Linux
  - после архивирования файлы теперь не удаляются. Если требуется
    их удалить, используйте каманду типа "m" (move) в командной строке
    архиватора.
  - добавлены примеры конфигов

Требования:
  - Python не ниже v2.6, а лучше v2.7 (или v2.5 для pyrotate v0.8 или ранее)
  - внешний архиватор в соответствии с параметром 'compress'

Программа для ротации или архивирования лог-файлов. Изначально писалась
для ротации именно лог-файлов, но вполне годится и для периодического
перемещения в архив любых файлов.

config file:
  logfile - имя или маска для задания множества лог-файлов, которые
    должны ротироваться или перемещаться в архив. Маска может включать
    такие символы как '*'. См. также секцию про "директивы задания формата
    даты в стиле языка Питон" в конце этого файла.

  keeps - в случае только ротации количество сохраняемых версий файла 

  compress - командная строка для архивирования файлов. Не все варианты
    тестировались, но пока рекомендуется при задании этого параметра
    указывает keeps равным 1. Теоретически здесь можно указать любой ваш
    любимый архиватор. Если не задан или задан равным 0 или пустой строке,
    то подразумевается отсутствие сжатия файла и logfile должен
    соответствовать единственному файлу.

  target - имя файла архива или маска для его генерации в соответствии с датой.
    Если не указано, то предполагается, что необходима только ротация и имя файла
    будет совпадать с именем лог-файла плюс номер ротации.

  period - daily (ежедневно), weekly(еженедельно) или monthly (ежемесячно).
    Реально используется только первая буква. По умолчанию равно 'monthly'.

  force - Если не равно нулю, то приводит к безусловной ротации файлов.
    Может использоваться в каких либо командных файлах для принудительной
    ротации файлов. Если не задано, то по умолчанию считается равным 0.

  priorfile - Если равно 1, то приводит к тому, что в процессе расчета даты
    периода при генерации имени лог-файлов участвует не текущая дата,
    а дата предыдущего периода ротации. Применяеется обычно когда осуществляется
    ротация только лог-файлов, созданных в предыдущем периоде.
    Например, 1 июня архивируются все майские файлы при ежемесячной
    ротации.

  priorarc - Если равно 1, то приводит к тому, что в процессе расчета даты
    периода при генерации имени файла архива участвует не текущая дата,
    а дата предыдущего периода ротации. Применяеется обычно когда осуществляется 
    ротация только лог-файлов, созданных в предыдущем периоде.
    Например, 1 июня архивируются все майские файлы при ежемесячной ротации
    и имя файла архива генерируется как-будто бы он создавался
    в мае (точнее месяц назад).

  sf - имя файла, в котором хранится статус ротации для текущего конфига
    (содержит дату последней ротации). Алгоритм работы таков: если при
    запуске статусный файл не найден или дата в нем соответствует дате
    предыдущего периода ротации, то осуществляется ротация и затем
    статусный файл перезаписывается. Если файл существует, то дата из него
    сравнивается с текущей. Если дата периода ротации из файла равна
    текущей дате ротации, то ротация не происходит.
    Если sf не задано, то по умолчанию для Windows-систем задается как
    <configfilenamefullpath.sta> и для остальных операционных систем как 
    <userdir>/.pyrotate/<configfilename.sta>.

  temp - если равно 1, то создается подкаталог temp в каталоге с лог
    файлами и перед ротацией в него помещаются все подлежащие ротации
    файлы, а после ротации весь каталог temp вместе с содержимым удаляется.
    По умолчанию = 0. Бывает необходимо в случае, когда в файл в момент
    ротации происходит дозаписывание данных. Для избежания изменения данных
    во время долгого процесса архивирования. Если равно 1, то ротируемые
    файлы не должны лочиться, а пишущая в лог-файлы программа должна уметь
    самостоятельно создавать новые файлы. В случае, когда происходит чистая
    ротация файлов без архивирования (не задан compress), параметр
    игнорируется и считается равным 0.

  mailfrom - отправитель сообщения об ошибке, например, 
    'mailfrom': 'pyrotate_backuper@firma.ru'
    'mailfrom': 'pyrotate_on_%s@firma.ru' % (ourhost,)
    где переменной ourhost в программе присваивается имя хоста,
    на котором она выполняется.
    Если параметр не указан, попытка отсылки сообщения не производится

  mailto - e-mail получателя сообщения
    если параметр не указан, попытка отсылки сообщения не производится

  smtp - имя или ip-адрес SMTP-сервера, через который будет отсылаться
    сообщение. Умолчние - localhost

  Следующие директивы задания формата даты в стиле языка Питон допустимы
  для генерации имени файлов в случае keeps < 2.

   Directive   Meaning         Notes
   %a  Locale's abbreviated weekday name.
   %A  Locale's full weekday name.
   %b  Locale's abbreviated month name.
   %B  Locale's full month name.
   %c  Locale's appropriate date and time representation.
   %d  Day of the month as a decimal number [01,31].
   %H  Hour (24-hour clock) as a decimal number [00,23].
   %I  Hour (12-hour clock) as a decimal number [01,12].
   %j  Day of the year as a decimal number [001,366].
   %m  Month as a decimal number [01,12].
   %M  Minute as a decimal number [00,59].
   %p  Locale's equivalent of either AM or PM. (1)
   %S  Second as a decimal number [00,61]. (2)
   %U  Week number of the year (Sunday as the first day of the week)
       as a decimal number [00,53]. All days in a new year preceding 
       the first Sunday are considered to be in week 0.    (3)
   %w  Weekday as a decimal number [0(Sunday),6].
   %W  Week number of the year (Monday as the first day of the week)
       as a decimal number [00,53]. All days in a new year preceding
       the first Monday are considered to be in week 0.    (3)
   %x  Locale's appropriate date representation.
   %X  Locale's appropriate time representation.
   %y  Year without century as a decimal number [00,99].
   %Y  Year with century as a decimal number.
   %Z  Time zone name (no characters if no time zone exists).
   %%  A literal "%" character.
